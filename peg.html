<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Low Level APIs" href="lowlevel.html" /><link rel="prev" title="How-To Guides" href="howto.html" />

    <meta name="generator" content="sphinx-3.5.3, furo 2021.03.20.beta30"/>
        <title>PEG APIs - Peppa PEG 1.9.0 documentation</title>
      <link rel="stylesheet" href="_static/styles/furo.css?digest=978e1795dfe158b585dda6a8417f6411828bf3ed">
    <link rel="stylesheet" href="_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" href="_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Peppa PEG 1.9.0 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">Peppa PEG 1.9.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutcalc.html">Tutorial: Calculator</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="howto.html">How-To Guides</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">PEG APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="lowlevel.html">Low Level APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">All APIs &amp; References</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug.html">Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html">Change Log</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <section id="peg-apis">
<h1>PEG APIs<a class="headerlink" href="#peg-apis" title="Permalink to this headline">¬∂</a></h1>
<section id="grammar-rules">
<h2>Grammar Rules<a class="headerlink" href="#grammar-rules" title="Permalink to this headline">¬∂</a></h2>
<p>The grammar is simply a list of rules with names. Rules are defined like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_1</span> <span class="o">=</span> <span class="o">...</span> <span class="p">;</span>
<span class="n">rule_2</span> <span class="o">=</span> <span class="o">...</span> <span class="p">;</span>
<span class="n">rule_3</span> <span class="o">=</span> <span class="o">...</span> <span class="p">;</span>
<span class="p">(</span><span class="n">more</span> <span class="n">rules</span><span class="p">)</span>
</pre></div>
</div>
<p>On the left hand side, they are rule names.</p>
<p>One the right hand side, they are rule expressions, which we will cover in this rest of the document.</p>
<p>In the middle, they are equal signs (<cite>=</cite>).</p>
<p>They should end with colons (<cite>;</cite>).</p>
<p>The first grammar rule will be assigned with rule id 1.
The ids for the rest increase one by one.</p>
<p>The grammar rule names must start with an alphabet or underscore,
followed by a sequence of either alphabets or digits or underscores <cite>_</cite>.</p>
</section>
<section id="literal">
<h2>Literal<a class="headerlink" href="#literal" title="Permalink to this headline">¬∂</a></h2>
<p>The literal matches an exact same string surrounded by double quotes.</p>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="s2">"hello world"</span><span class="p">;</span>
</pre></div>
</div>
<p>To ignore the case, insert <cite>i</cite> to the left quote:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="n">i</span><span class="s2">"hello world"</span><span class="p">;</span>
</pre></div>
</div>
<p>The case insensitive literal applies to not only ASCII chars, but also extended ASCII chars, such as √¨ / √å.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="n">i</span><span class="s2">"hello wor√¨d"</span><span class="p">;</span>
</pre></div>
</div>
<p>UTF-8 is supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="s2">"‰Ω†Â•ΩÔºå‰∏ñÁïå"</span><span class="p">;</span>
</pre></div>
</div>
<p>Emoji is supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="s2">"Peppa üê∑"</span><span class="p">;</span>
</pre></div>
</div>
<p>You can encode UTF-8 code points via <cite>u</cite> followed by hex digits.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="s2">"\u</span><span class="si">{4f60}</span><span class="s2">\u</span><span class="si">{597D}</span><span class="s2">, world\u</span><span class="si">{0c}</span><span class="s2">"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="range">
<h2>Range<a class="headerlink" href="#range" title="Permalink to this headline">¬∂</a></h2>
<p>Range <strong>matches a single character in range</strong>.</p>
<p>In this example, any character between <cite>‚Äò0‚Äô</cite> to <cite>‚Äò9‚Äô</cite> can match.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">digits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">];</span>
</pre></div>
</div>
<p>The lower and upper character of the range can be not only ASCII characters but also UTF-8 code points.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">digits</span> <span class="o">=</span> <span class="p">[</span>\<span class="n">u</span><span class="p">{</span><span class="mf">4e00</span><span class="p">}</span><span class="o">-</span>\<span class="n">u</span><span class="p">{</span><span class="mi">9</span><span class="n">fff</span><span class="p">}];</span>
</pre></div>
</div>
<p>A small trick to match any character is to specify the range from <cite>u{1}</cite> to <cite>u{10ffff}</cite>,
which are the minimum and the maximum code point in UTF-8 encoding.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">any</span> <span class="o">=</span> <span class="p">[</span>\<span class="n">u</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="o">-</span>\<span class="n">u</span><span class="p">{</span><span class="mi">10</span><span class="n">ffff</span><span class="p">}];</span>
</pre></div>
</div>
<p>The value of lower must be less or equal than the upper.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">INVALID</span>
<span class="nb">any</span> <span class="o">=</span> <span class="p">[</span>\<span class="n">u</span><span class="p">{</span><span class="mi">10</span><span class="n">ffff</span><span class="p">}</span><span class="o">-</span>\<span class="n">u</span><span class="p">{</span><span class="mi">1</span><span class="p">}];</span>
</pre></div>
</div>
<p>Range supports an optional <cite>stride</cite> to skip certain amount of characters in the range.
In this example, only odd number between <cite>‚Äò0‚Äô</cite> to <cite>‚Äò9‚Äô</cite> can match.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">digits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mf">9.</span><span class="o">.</span><span class="mi">2</span><span class="p">];</span>
</pre></div>
</div>
</section>
<section id="sequence">
<h2>Sequence<a class="headerlink" href="#sequence" title="Permalink to this headline">¬∂</a></h2>
<p>Sequence <strong>matches a sequence of sub-expressions in order</strong>.</p>
<p>When parsing, the first sequence member is attempted. If succeeds, the second is attempted, so on and on.
If any one of the attempts fails, the match fails.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeter</span> <span class="o">=</span> <span class="s2">"Hello"</span> <span class="s2">" "</span> <span class="s2">"world"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="choice">
<h2>Choice<a class="headerlink" href="#choice" title="Permalink to this headline">¬∂</a></h2>
<p>Choice <strong>matches one of the sub-expression.</strong></p>
<p>When parsing, the first sequence member is attempted. If fails, the second is attempted, so on and on.
If any one of the attempts succeeds, the match succeeds. If all attempts fail, the match fails.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeter</span> <span class="o">=</span> <span class="s2">"Hello World"</span> <span class="o">/</span> <span class="s2">"‰Ω†Â•ΩÔºå‰∏ñÁïå"</span> <span class="o">/</span> <span class="s2">"Kia Ora"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¬∂</a></h2>
<p>Reference <strong>matches a string based on the referenced grammar rule</strong>.</p>
<p>For example, <cite>greeter</cite> is just a reference rule in <cite>greeting</cite>. When matching <cite>greeting</cite>, it will use the referenced grammar rule <cite>greeter</cite> first, e.g. <cite>‚ÄúHello‚Äù / ‚Äú‰Ω†Â•Ω‚Äù</cite>, then match ‚Äù world‚Äù.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="n">greeter</span> <span class="s2">" world"</span><span class="p">;</span>
<span class="n">greeter</span>  <span class="o">=</span> <span class="s2">"Hello"</span> <span class="o">/</span> <span class="s2">"‰Ω†Â•Ω"</span><span class="p">;</span>
</pre></div>
</div>
<p>The order of defining a rule does not matter.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeter</span>  <span class="o">=</span> <span class="s2">"Hello"</span> <span class="o">/</span> <span class="s2">"‰Ω†Â•Ω"</span><span class="p">;</span>
<span class="n">greeting</span> <span class="o">=</span> <span class="n">greeter</span> <span class="s2">" world"</span><span class="p">;</span>
</pre></div>
</div>
<p>One should ensure all references must have corresponding rule defined, otherwise, the parse will fail with <a class="reference internal" href="api.html#c.P4_Error.P4_MatchError" title="P4_MatchError"><code class="xref c c-enum docutils literal notranslate"><span class="pre">P4_MatchError</span></code></a>.</p>
</section>
<section id="positive">
<h2>Positive<a class="headerlink" href="#positive" title="Permalink to this headline">¬∂</a></h2>
<p>Positive <strong>tests if the sub-expression matches</strong>.</p>
<p>Positive attempts to match the sub-expression. If succeeds, the test passes. Positive does not ‚Äúconsume‚Äù any text.</p>
<p>Positive can be useful in limiting the possibilities of the latter member in a Sequence. In this example, the Sequence expression must start with ‚ÄúHello‚Äù, e.g. ‚ÄúHello World‚Äù, ‚ÄúHello WORLD‚Äù, ‚ÄúHello world‚Äù, etc, will match but ‚ÄúHELLO WORLD‚Äù will not match.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="o">&amp;</span><span class="s2">"Hello"</span> <span class="n">i</span><span class="s2">"hello world"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="negative">
<h2>Negative<a class="headerlink" href="#negative" title="Permalink to this headline">¬∂</a></h2>
<p>Negative <strong>tests if the sub-expression does not match</strong>.</p>
<p>Negative expects the sub-expression doesn‚Äôt match. If fails, the test passes. Negative does not ‚Äúconsume‚Äù any text.</p>
<p>Negative can be useful in limiting the possiblities of the latter member in a Sequence. In this example, the Sequence expression must not start with ‚ÄúHello‚Äù, e.g. ‚ÄúHELLO World‚Äù, ‚Äúhello WORLD‚Äù, ‚Äúhello world‚Äù, etc, will match but ‚ÄúHello World‚Äù will not match.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>greeting = !"Hello" i"hello world";
</pre></div>
</div>
</section>
<section id="repeat">
<h2>Repeat<a class="headerlink" href="#repeat" title="Permalink to this headline">¬∂</a></h2>
<p>Repeat <strong>matches the sub-expression several times</strong>.</p>
<p><cite>+</cite> match string one or more times.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">number</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="p">;</span>
</pre></div>
</div>
<p><cite>*</cite> match string zero or more times.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">number</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">;</span>
</pre></div>
</div>
<p><cite>?</cite> match string one or more times.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>number = [0-9] "."?;
</pre></div>
</div>
<p><cite>{min,}</cite> match string minimum <cite>min</cite> times.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">above_hundred</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">2</span><span class="p">,};</span>
</pre></div>
</div>
<p><cite>{,max}</cite> match string maximum <cite>max</cite> times.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">below_thousand</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{,</span><span class="mi">3</span><span class="p">};</span>
</pre></div>
</div>
<p><cite>{min,max}</cite> match string minimum <cite>min</cite> times, maximum <cite>max</cite> times.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">hex</span> <span class="o">=</span> <span class="s2">"\u{"</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span> <span class="o">/</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">z</span><span class="p">]</span> <span class="o">/</span> <span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Z</span><span class="p">]){</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">}</span> <span class="s2">"}"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="grammar-rule-flags">
<h2>Grammar Rule Flags<a class="headerlink" href="#grammar-rule-flags" title="Permalink to this headline">¬∂</a></h2>
<p>The grammar rule allows setting flags by inserting some <cite>@decorator</cite> (s) before the names.
The supported decorators include: <cite>@spaced</cite>, <cite>@squashed</cite>, <cite>@scoped</cite>, <cite>@tight</cite>, <cite>@lifted</cite> and <cite>@nonterminal</cite>.
For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@spaced</span> <span class="nd">@lifted</span>
<span class="n">ws</span> <span class="o">=</span> <span class="s2">" "</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">seealso</dt>
<dd class="field-odd"><p><a class="reference internal" href="api.html#c.P4_FLAG_SPACED" title="P4_FLAG_SPACED"><code class="xref c c-enum docutils literal notranslate"><span class="pre">P4_FLAG_SPACED</span></code></a>, <a class="reference internal" href="api.html#c.P4_FLAG_SQUASHED" title="P4_FLAG_SQUASHED"><code class="xref c c-enum docutils literal notranslate"><span class="pre">P4_FLAG_SQUASHED</span></code></a>, <a class="reference internal" href="api.html#c.P4_FLAG_SCOPED" title="P4_FLAG_SCOPED"><code class="xref c c-enum docutils literal notranslate"><span class="pre">P4_FLAG_SCOPED</span></code></a>, <a class="reference internal" href="api.html#c.P4_FLAG_TIGHT" title="P4_FLAG_TIGHT"><code class="xref c c-enum docutils literal notranslate"><span class="pre">P4_FLAG_TIGHT</span></code></a>, <a class="reference internal" href="api.html#c.P4_FLAG_LIFTED" title="P4_FLAG_LIFTED"><code class="xref c c-enum docutils literal notranslate"><span class="pre">P4_FLAG_LIFTED</span></code></a>, <a class="reference internal" href="api.html#c.P4_FLAG_NON_TERMINAL" title="P4_FLAG_NON_TERMINAL"><code class="xref c c-enum docutils literal notranslate"><span class="pre">P4_FLAG_NON_TERMINAL</span></code></a>.</p>
</dd>
</dl>
<section id="spaced">
<h3>@spaced<a class="headerlink" href="#spaced" title="Permalink to this headline">¬∂</a></h3>
<p>If a rule has <cite>@spaced</cite> decorator, it will be auto-inserted in between every element of sequences and repetitions.</p>
<p>For example, my sequence can match ‚Äúhelloworld‚Äù, ‚Äúhello world‚Äù, ‚Äúhello  t  n world‚Äù, etc.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_sequence</span> <span class="o">=</span> <span class="s2">"hello"</span> <span class="s2">"world"</span><span class="p">;</span>

<span class="nd">@spaced</span>
<span class="n">ws</span> <span class="o">=</span> <span class="s2">" "</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="tight">
<h3>@tight<a class="headerlink" href="#tight" title="Permalink to this headline">¬∂</a></h3>
<p>If a sequence or repetition rule has <cite>@tight</cite> decorator, no <cite>@spaced</cite> rules will be applied.</p>
<p>For example, my_another_sequence can only match ‚Äúhelloworld‚Äù.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_another_sequence</span> <span class="o">=</span> <span class="s2">"hello"</span> <span class="s2">"world"</span><span class="p">;</span>

<span class="nd">@spaced</span>
<span class="n">ws</span> <span class="o">=</span> <span class="s2">" "</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="lifted">
<h3>@lifted<a class="headerlink" href="#lifted" title="Permalink to this headline">¬∂</a></h3>
<p>If a rule has <cite>@lifted</cite> decorator, its children tokens will replace the parent token.</p>
<p>In this example, the parsed token tree has no token mapping to primary rule, but rather either digit or char.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@lifted</span>
<span class="n">primary</span> <span class="o">=</span> <span class="n">digit</span> <span class="o">/</span> <span class="n">char</span><span class="p">;</span>

<span class="n">number</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">];</span>
<span class="n">char</span>   <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">z</span><span class="p">]</span> <span class="o">/</span> <span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Z</span><span class="p">];</span>
</pre></div>
</div>
</section>
<section id="nonterminal">
<h3>@nonterminal<a class="headerlink" href="#nonterminal" title="Permalink to this headline">¬∂</a></h3>
<p>If a rule has <cite>nonterminal</cite> decorator, and it has only one single child token, the child token will replace the parent token.</p>
<p>If it produces multiple children tokens, this decorator has no effect.</p>
<p>In this example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@lifted
add = number ("+" number)?;

number = [0-9];
</pre></div>
</div>
<p>If we feed the input ‚Äú1‚Äù, the token tree is like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>If we feed the input ‚Äú1+1‚Äù, the token tree is like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">Number</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Number</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="squashed">
<h3>@squashed<a class="headerlink" href="#squashed" title="Permalink to this headline">¬∂</a></h3>
<p>If a rule has <cite>@squashed</cite> decorator, its children tokens will be trimmed.</p>
<p>In this example, the rule <cite>float</cite> will drop all <cite>number</cite> tokens, leaving only one single node in the ast.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@squashed
float = number ("." number)?;

number = [0-9];
</pre></div>
</div>
</section>
</section>
<section id="use-peg-api">
<h2>Use Peg API<a class="headerlink" href="#use-peg-api" title="Permalink to this headline">¬∂</a></h2>
<p>Function <a class="reference internal" href="api.html#c.P4_LoadGrammar" title="P4_LoadGrammar"><code class="xref c c-func docutils literal notranslate"><span class="pre">P4_LoadGrammar()</span></code></a> can load a grammar from a string.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">P4_Grammar</span><span class="o">*</span> <span class="n">grammar</span> <span class="o">=</span> <span class="n">P4_LoadGrammar</span><span class="p">(</span>
    <span class="s2">"add = int + int;"</span>

    <span class="s2">"@squashed @tight "</span>
    <span class="s2">"int = [0-9]+;"</span>

    <span class="s2">"@spaced @lifted "</span>
    <span class="s2">"ws  = </span><span class="se">\"</span><span class="s2"> </span><span class="se">\"</span><span class="s2">;"</span><span class="p">;</span>
<span class="p">);</span>
</pre></div>
</div>
<p>The one-statement code is somewhat equivalent to the below code written in low-level C API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">P4_Grammar</span><span class="o">*</span> <span class="n">grammar</span> <span class="o">=</span> <span class="n">P4_CreateGrammar</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="n">P4_Ok</span> <span class="o">!=</span> <span class="n">P4_AddSequenceWithMembers</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">RuleAdd</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">P4_CreateReference</span><span class="p">(</span><span class="n">RuleInt</span><span class="p">),</span>
    <span class="n">P4_CreateLiteral</span><span class="p">(</span><span class="s2">"+"</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
    <span class="n">P4_CreateReference</span><span class="p">(</span><span class="n">RuleInt</span><span class="p">)</span>
<span class="p">))</span>
    <span class="n">goto</span> <span class="n">finalize</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">P4_Ok</span> <span class="o">!=</span> <span class="n">P4_AddOnceOrMore</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">RuleInt</span><span class="p">,</span> <span class="n">P4_CreateRange</span><span class="p">(</span><span class="s1">'0'</span><span class="p">,</span> <span class="s1">'9'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">goto</span> <span class="n">finalize</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">P4_Ok</span> <span class="o">!=</span> <span class="n">P4_SetGrammarRuleFlag</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">RuleInt</span><span class="p">,</span> <span class="n">P4_FLAG_SQUASHED</span><span class="o">|</span><span class="n">P4_FLAG_TIGHT</span><span class="p">))</span>
    <span class="n">goto</span> <span class="n">finalize</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">P4_Ok</span> <span class="o">!=</span> <span class="n">P4_AddLiteral</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">RuleWs</span><span class="p">,</span> <span class="s2">" "</span><span class="p">,</span> <span class="n">true</span><span class="p">))</span>
    <span class="n">goto</span> <span class="n">finalize</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">P4_Ok</span> <span class="o">!=</span> <span class="n">P4_SetGrammarRuleFlag</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">RuleWs</span><span class="p">,</span> <span class="n">P4_FLAG_SPACED</span><span class="o">|</span><span class="n">P4_FLAG_LIFTED</span><span class="p">))</span>
    <span class="n">goto</span> <span class="n">finalize</span><span class="p">;</span>
</pre></div>
</div>
</section>
</section>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="lowlevel.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Low Level APIs</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="howto.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">How-To Guides</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, Ju
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="_sources/peg.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">PEG APIs</a><ul>
<li><a class="reference internal" href="#grammar-rules">Grammar Rules</a></li>
<li><a class="reference internal" href="#literal">Literal</a></li>
<li><a class="reference internal" href="#range">Range</a></li>
<li><a class="reference internal" href="#sequence">Sequence</a></li>
<li><a class="reference internal" href="#choice">Choice</a></li>
<li><a class="reference internal" href="#reference">Reference</a></li>
<li><a class="reference internal" href="#positive">Positive</a></li>
<li><a class="reference internal" href="#negative">Negative</a></li>
<li><a class="reference internal" href="#repeat">Repeat</a></li>
<li><a class="reference internal" href="#grammar-rule-flags">Grammar Rule Flags</a><ul>
<li><a class="reference internal" href="#spaced">&#64;spaced</a></li>
<li><a class="reference internal" href="#tight">&#64;tight</a></li>
<li><a class="reference internal" href="#lifted">&#64;lifted</a></li>
<li><a class="reference internal" href="#nonterminal">&#64;nonterminal</a></li>
<li><a class="reference internal" href="#squashed">&#64;squashed</a></li>
</ul>
</li>
<li><a class="reference internal" href="#use-peg-api">Use Peg API</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>
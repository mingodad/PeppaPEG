<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Low Level APIs" href="lowlevel.html" /><link rel="prev" title="Concepts" href="concepts.html" />

    <meta name="generator" content="sphinx-4.1.2, furo 2021.07.31.beta41"/>
        <title>PEG APIs - Peppa PEG 1.14.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=daa650a7760fac3eee23aa959745d2c866b74cb3" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=93475b62d1c3bc01323a0eefdc14a62d77b12690" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style>
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="_static/pygments_dark.css"></head>
  <body>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Peppa PEG 1.14.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">Peppa PEG 1.14.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutcalc.html">Tutorial: Calculator</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutjson.html">Tutorial: JSON</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="howto.html">How-To Guides</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">PEG APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="lowlevel.html">Low Level APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">All APIs &amp; References</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug.html">Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html">Change Log</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <article role="main">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <section id="peg-apis">
<span id="peg"></span><h1>PEG APIs<a class="headerlink" href="#peg-apis" title="Permalink to this headline">¶</a></h1>
<section id="grammar-rules">
<h2>Grammar Rules<a class="headerlink" href="#grammar-rules" title="Permalink to this headline">¶</a></h2>
<p>The grammar is simply a list of rules with names. Rules are defined like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rule_1</span> <span class="o">=</span> <span class="o">...</span> <span class="p">;</span>
<span class="n">rule_2</span> <span class="o">=</span> <span class="o">...</span> <span class="p">;</span>
<span class="n">rule_3</span> <span class="o">=</span> <span class="o">...</span> <span class="p">;</span>
<span class="p">(</span><span class="n">more</span> <span class="n">rules</span><span class="p">)</span>
</pre></div>
</div>
<p>On the left hand side, they are rule names.</p>
<p>One the right hand side, they are rule expressions, which we will cover in this rest of the document.</p>
<p>In the middle, they are equal signs (<cite>=</cite>).</p>
<p>They should end with colons (<cite>;</cite>).</p>
<p>The first grammar rule will be assigned with rule id 1.
The ids for the rest increase one by one.</p>
<p>The grammar rule names must start with an alphabet or underscore,
followed by a sequence of either alphabets or digits or underscores <cite>_</cite>.</p>
</section>
<section id="literal">
<h2>Literal<a class="headerlink" href="#literal" title="Permalink to this headline">¶</a></h2>
<p>The literal matches an exact same string surrounded by double quotes.</p>
<p>For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="s2">"hello world"</span><span class="p">;</span>
</pre></div>
</div>
<p>To ignore the case, insert <cite>i</cite> to the left quote:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="n">i</span><span class="s2">"hello world"</span><span class="p">;</span>
</pre></div>
</div>
<p>The case insensitive literal applies to not only ASCII chars, but also extended ASCII chars, such as ì / Ì.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="n">i</span><span class="s2">"hello worìd"</span><span class="p">;</span>
</pre></div>
</div>
<p>UTF-8 is supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="s2">"你好，世界"</span><span class="p">;</span>
</pre></div>
</div>
<p>Emoji is supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="s2">"Peppa 🐷"</span><span class="p">;</span>
</pre></div>
</div>
<p>You can encode ASCII characters via <cite>\x</cite> followed by 2 hex digits.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\x48\x65\x6c\x6c\x6f</span><span class="s2">, world"</span><span class="p">;</span>
</pre></div>
</div>
<p>You can encode UTF-8 characters via <cite>\u</cite> followed by 4 hex digits or <cite>\U</cite> followed by 8 hex digits.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\u4f60\u597D</span><span class="s2">, world</span><span class="se">\u000c</span><span class="s2">"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="range">
<h2>Range<a class="headerlink" href="#range" title="Permalink to this headline">¶</a></h2>
<p>Range <strong>matches a single character in range</strong>.</p>
<p>In this example, any character between <cite>‘0’</cite> to <cite>‘9’</cite> can match.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">digits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">];</span>
</pre></div>
</div>
<p>The lower and upper character of the range can be not only ASCII characters but also UTF-8 code points.
The syntax can be <cite>\uXXXX</cite> or <cite>\uXXXXXXXX</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">digits</span> <span class="o">=</span> <span class="p">[</span>\<span class="n">u4e00</span><span class="o">-</span>\<span class="n">u9fff</span><span class="p">];</span>
</pre></div>
</div>
<p>A small trick to match any character is to specify the range from <cite>\u0001</cite> to <cite>\U0010ffff</cite>,
which are the minimum and the maximum code point in UTF-8 encoding.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">any</span> <span class="o">=</span> <span class="p">[</span>\<span class="n">u0001</span><span class="o">-</span>\<span class="n">U0010ffff</span><span class="p">];</span>
</pre></div>
</div>
<p>The value of lower must be less or equal than the upper.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">INVALID</span>
<span class="nb">any</span> <span class="o">=</span> <span class="p">[</span>\<span class="n">U0010ffff</span><span class="o">-</span>\<span class="n">u0001</span><span class="p">];</span>
</pre></div>
</div>
<p>Range supports an optional <cite>stride</cite> to skip certain amount of characters in the range.
In this example, only odd number between <cite>‘0’</cite> to <cite>‘9’</cite> can match.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">digits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mf">9..2</span><span class="p">];</span>
</pre></div>
</div>
<p>Range also supports certain unicode character sets,  such as <cite>C</cite>, <cite>Cc</cite>, <cite>Cf</cite>, <cite>Co</cite>, <cite>Cs</cite>,
<cite>Ll</cite>, <cite>Lm</cite>, <cite>Lo</cite>, <cite>Lt</cite>, <cite>Lu</cite>, <cite>L</cite>, <cite>Nd</cite>, <cite>Nl</cite>, <cite>No</cite>, <cite>N</cite>, etc.
They’re wrapped via <cite>\p{}</cite>, for example:</p>
<ul class="simple">
<li><p>unicode_letter: a Unicode code point classified as “Letter” (Ll+Lm+Lo+Lt+Lu).</p></li>
<li><p>unicode_digit: a Unicode code point classified as “Number, decimal digit”(Nd).</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unicode_letter</span> <span class="o">=</span> <span class="p">[</span>\<span class="n">p</span><span class="p">{</span><span class="n">L</span><span class="p">}];</span>
<span class="n">unicode_digit</span>  <span class="o">=</span> <span class="p">[</span>\<span class="n">p</span><span class="p">{</span><span class="n">Nd</span><span class="p">}];</span>
</pre></div>
</div>
</section>
<section id="dot">
<h2>Dot<a class="headerlink" href="#dot" title="Permalink to this headline">¶</a></h2>
<p>Single dot <cite>.</cite> can match any UTF-8 code point. It’s a syntax sugar for <cite>[\u0001-\U0010ffff]</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">any</span> <span class="o">=</span> <span class="o">.</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="sequence">
<h2>Sequence<a class="headerlink" href="#sequence" title="Permalink to this headline">¶</a></h2>
<p>Sequence <strong>matches a sequence of sub-expressions in order</strong>.</p>
<p>When parsing, the first sequence member is attempted. If succeeds, the second is attempted, so on and on.
If any one of the attempts fails, the match fails.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeter</span> <span class="o">=</span> <span class="s2">"Hello"</span> <span class="s2">" "</span> <span class="s2">"world"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="choice">
<h2>Choice<a class="headerlink" href="#choice" title="Permalink to this headline">¶</a></h2>
<p>Choice <strong>matches one of the sub-expression.</strong></p>
<p>When parsing, the first sequence member is attempted. If fails, the second is attempted, so on and on.
If any one of the attempts succeeds, the match succeeds. If all attempts fail, the match fails.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeter</span> <span class="o">=</span> <span class="s2">"Hello World"</span> <span class="o">/</span> <span class="s2">"你好，世界"</span> <span class="o">/</span> <span class="s2">"Kia Ora"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h2>
<p>Reference <strong>matches a string based on the referenced grammar rule</strong>.</p>
<p>For example, <cite>greeter</cite> is just a reference rule in <cite>greeting</cite>. When matching <cite>greeting</cite>, it will use the referenced grammar rule <cite>greeter</cite> first, e.g. <cite>“Hello” / “你好”</cite>, then match ” world”.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="n">greeter</span> <span class="s2">" world"</span><span class="p">;</span>
<span class="n">greeter</span>  <span class="o">=</span> <span class="s2">"Hello"</span> <span class="o">/</span> <span class="s2">"你好"</span><span class="p">;</span>
</pre></div>
</div>
<p>The order of defining a rule does not matter.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeter</span>  <span class="o">=</span> <span class="s2">"Hello"</span> <span class="o">/</span> <span class="s2">"你好"</span><span class="p">;</span>
<span class="n">greeting</span> <span class="o">=</span> <span class="n">greeter</span> <span class="s2">" world"</span><span class="p">;</span>
</pre></div>
</div>
<p>One should ensure all references must have corresponding rule defined, otherwise, the parse will fail with <a class="reference internal" href="api.html#c.P4_Error.P4_MatchError" title="P4_MatchError"><code class="xref c c-enum docutils literal notranslate"><span class="pre">P4_MatchError</span></code></a>.</p>
</section>
<section id="positive">
<h2>Positive<a class="headerlink" href="#positive" title="Permalink to this headline">¶</a></h2>
<p>Positive <strong>tests if the sub-expression matches</strong>.</p>
<p>Positive attempts to match the sub-expression. If succeeds, the test passes. Positive does not “consume” any text.</p>
<p>Positive can be useful in limiting the possibilities of the latter member in a Sequence. In this example, the Sequence expression must start with “Hello”, e.g. “Hello World”, “Hello WORLD”, “Hello world”, etc, will match but “HELLO WORLD” will not match.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">greeting</span> <span class="o">=</span> <span class="o">&amp;</span><span class="s2">"Hello"</span> <span class="n">i</span><span class="s2">"hello world"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="negative">
<h2>Negative<a class="headerlink" href="#negative" title="Permalink to this headline">¶</a></h2>
<p>Negative <strong>tests if the sub-expression does not match</strong>.</p>
<p>Negative expects the sub-expression doesn’t match. If fails, the test passes. Negative does not “consume” any text.</p>
<p>Negative can be useful in limiting the possiblities of the latter member in a Sequence. In this example, the Sequence expression must not start with “Hello”, e.g. “HELLO World”, “hello WORLD”, “hello world”, etc, will match but “Hello World” will not match.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>greeting = !"Hello" i"hello world";
</pre></div>
</div>
</section>
<section id="repeat">
<h2>Repeat<a class="headerlink" href="#repeat" title="Permalink to this headline">¶</a></h2>
<p>Repeat <strong>matches the sub-expression several times</strong>.</p>
<p><cite>+</cite> match string one or more times.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">number</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="p">;</span>
</pre></div>
</div>
<p><cite>*</cite> match string zero or more times.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">number</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="p">;</span>
</pre></div>
</div>
<p><cite>?</cite> match string one or more times.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>number = [0-9] "."?;
</pre></div>
</div>
<p><cite>{min,}</cite> match string minimum <cite>min</cite> times.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">above_hundred</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span> <span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">9</span><span class="p">]{</span><span class="mi">2</span><span class="p">,};</span>
</pre></div>
</div>
<p><cite>{,max}</cite> match string maximum <cite>max</cite> times.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">below_thousand</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]{,</span><span class="mi">3</span><span class="p">};</span>
</pre></div>
</div>
<p><cite>{min,max}</cite> match string minimum <cite>min</cite> times, maximum <cite>max</cite> times.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">hex</span> <span class="o">=</span> <span class="s2">"\u{"</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span> <span class="o">/</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">z</span><span class="p">]</span> <span class="o">/</span> <span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Z</span><span class="p">]){</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">}</span> <span class="s2">"}"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="cut">
<h2>Cut<a class="headerlink" href="#cut" title="Permalink to this headline">¶</a></h2>
<p>Cut is a decorator written as “@cut”. It always succeeds, but cannot be backtracked.
It’s used to prevent unwanted backtracking, e.g. to prevent excessive choice options.</p>
<p>Backtracking means if e1 in <cite>rule = e1 / e2;</cite> fails, the parser returns the last position where e1 started, and tries e2.
If there is a <cite>@cut</cite> in e1, any failure after the cutting point will cause rule failed immediately.
Cut ensures the parse sticks to the current rule, even if it fails to parse.
See ideas [1](<a class="reference external" href="http://ceur-ws.org/Vol-1269/paper232.pdf">http://ceur-ws.org/Vol-1269/paper232.pdf</a>), [2](<a class="reference external" href="https://news.ycombinator.com/item?id=20503245">https://news.ycombinator.com/item?id=20503245</a>).</p>
<p>For example, considering the grammar below first,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="n">array</span> <span class="o">/</span> <span class="n">null</span><span class="p">;</span>
<span class="n">array</span> <span class="o">=</span> <span class="s2">"["</span> <span class="s2">"]"</span><span class="p">;</span>
<span class="n">null</span>  <span class="o">=</span> <span class="s2">"null"</span><span class="p">;</span>
</pre></div>
</div>
<p>Given input “[”, it attempts matching array first. After failed, it will try null next. At last, value match is failed.</p>
<p>Let’s add a cut operator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="n">array</span> <span class="o">/</span> <span class="n">null</span><span class="p">;</span>
<span class="n">array</span> <span class="o">=</span> <span class="s2">"["</span> <span class="nd">@cut</span> <span class="s2">"]"</span><span class="p">;</span>
<span class="n">null</span>  <span class="o">=</span> <span class="s2">"null"</span><span class="p">;</span>
</pre></div>
</div>
<p>Given input “[”, it attempts matching array first. After failed, value match is failed immediately.</p>
<p>Given input “null”, it attempts matching array first. It fails before <cite>@cut</cite> and then failed matching array. Parser then match “null” successfully.</p>
</section>
<section id="comment">
<h2>Comment<a class="headerlink" href="#comment" title="Permalink to this headline">¶</a></h2>
<p>Comment are any characters followed by a # (included) in a line.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># THIS IS A COMMENT.</span>
<span class="n">rule</span> <span class="o">=</span> <span class="s2">"hello"</span><span class="p">;</span> <span class="c1"># THIS IS ANOTHER COMMENT.</span>
</pre></div>
</div>
<p>Comments are ignored.</p>
</section>
<section id="grammar-rule-flags">
<h2>Grammar Rule Flags<a class="headerlink" href="#grammar-rule-flags" title="Permalink to this headline">¶</a></h2>
<p>The grammar rule allows setting flags by inserting some <cite>@decorator</cite> (s) before the names.
The supported decorators include: <cite>@spaced</cite>, <cite>@squashed</cite>, <cite>@scoped</cite>, <cite>@tight</cite>, <cite>@lifted</cite> and <cite>@nonterminal</cite>.
For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@spaced</span> <span class="nd">@lifted</span>
<span class="n">ws</span> <span class="o">=</span> <span class="s2">" "</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">seealso</dt>
<dd class="field-odd"><p><a class="reference internal" href="api.html#c.P4_FLAG_SPACED" title="P4_FLAG_SPACED"><code class="xref c c-enum docutils literal notranslate"><span class="pre">P4_FLAG_SPACED</span></code></a>, <a class="reference internal" href="api.html#c.P4_FLAG_SQUASHED" title="P4_FLAG_SQUASHED"><code class="xref c c-enum docutils literal notranslate"><span class="pre">P4_FLAG_SQUASHED</span></code></a>, <a class="reference internal" href="api.html#c.P4_FLAG_SCOPED" title="P4_FLAG_SCOPED"><code class="xref c c-enum docutils literal notranslate"><span class="pre">P4_FLAG_SCOPED</span></code></a>, <a class="reference internal" href="api.html#c.P4_FLAG_TIGHT" title="P4_FLAG_TIGHT"><code class="xref c c-enum docutils literal notranslate"><span class="pre">P4_FLAG_TIGHT</span></code></a>, <a class="reference internal" href="api.html#c.P4_FLAG_LIFTED" title="P4_FLAG_LIFTED"><code class="xref c c-enum docutils literal notranslate"><span class="pre">P4_FLAG_LIFTED</span></code></a>, <a class="reference internal" href="api.html#c.P4_FLAG_NON_TERMINAL" title="P4_FLAG_NON_TERMINAL"><code class="xref c c-enum docutils literal notranslate"><span class="pre">P4_FLAG_NON_TERMINAL</span></code></a>.</p>
</dd>
</dl>
<section id="spaced">
<h3>@spaced<a class="headerlink" href="#spaced" title="Permalink to this headline">¶</a></h3>
<p>If a rule has <cite>@spaced</cite> decorator, it will be auto-inserted in between every element of sequences and repetitions.</p>
<p>For example, my sequence can match “helloworld”, “hello world”, “hello  t  n world”, etc.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_sequence</span> <span class="o">=</span> <span class="s2">"hello"</span> <span class="s2">"world"</span><span class="p">;</span>

<span class="nd">@spaced</span>
<span class="n">ws</span> <span class="o">=</span> <span class="s2">" "</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="tight">
<h3>@tight<a class="headerlink" href="#tight" title="Permalink to this headline">¶</a></h3>
<p>If a sequence or repetition rule has <cite>@tight</cite> decorator, no <cite>@spaced</cite> rules will be applied.</p>
<p>For example, my_another_sequence can only match “helloworld”.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_another_sequence</span> <span class="o">=</span> <span class="s2">"hello"</span> <span class="s2">"world"</span><span class="p">;</span>

<span class="nd">@spaced</span>
<span class="n">ws</span> <span class="o">=</span> <span class="s2">" "</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span> <span class="o">/</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="lifted">
<h3>@lifted<a class="headerlink" href="#lifted" title="Permalink to this headline">¶</a></h3>
<p>If a rule has <cite>@lifted</cite> decorator, its children will replace the parent.</p>
<p>In this example, the parsed tree has no node mapping to primary rule, but rather either digit or char.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@lifted</span>
<span class="n">primary</span> <span class="o">=</span> <span class="n">digit</span> <span class="o">/</span> <span class="n">char</span><span class="p">;</span>

<span class="n">number</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">];</span>
<span class="n">char</span>   <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">z</span><span class="p">]</span> <span class="o">/</span> <span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Z</span><span class="p">];</span>
</pre></div>
</div>
</section>
<section id="nonterminal">
<h3>@nonterminal<a class="headerlink" href="#nonterminal" title="Permalink to this headline">¶</a></h3>
<p>If a rule has <cite>nonterminal</cite> decorator, and it has only one single child node, the child node will replace the parent node.</p>
<p>If it produces multiple children, this decorator has no effect.</p>
<p>In this example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@lifted
add = number ("+" number)?;

number = [0-9];
</pre></div>
</div>
<p>If we feed the input “1”, the tree is like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>If we feed the input “1+1”, the tree is like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">Number</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Number</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="squashed">
<h3>@squashed<a class="headerlink" href="#squashed" title="Permalink to this headline">¶</a></h3>
<p>If a rule has <cite>@squashed</cite> decorator, its children will be trimmed.</p>
<p>In this example, the rule <cite>float</cite> will drop all <cite>number</cite> nodes, leaving only one single node in the ast.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@squashed
float = number ("." number)?;

number = [0-9];
</pre></div>
</div>
</section>
<section id="scoped">
<h3>@scoped<a class="headerlink" href="#scoped" title="Permalink to this headline">¶</a></h3>
<p>Ignore all the decorators set by upstream rules.</p>
<p>For example, despite <cite>greeting2</cite> set to not using spaced rule <cite>ws</cite>, <cite>greeting</cite> can still apply to <cite>ws</cite> since it’s under its own scope.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@tight</span>
<span class="n">greeting2</span> <span class="o">=</span> <span class="n">greeting</span> <span class="n">greeting</span><span class="p">;</span>

<span class="nd">@scoped</span>
<span class="n">greeting</span> <span class="o">=</span> <span class="s2">"hello"</span> <span class="s2">"world"</span><span class="p">;</span>

<span class="nd">@spaced</span>
<span class="n">ws</span> <span class="o">=</span> <span class="s2">" "</span><span class="p">;</span>
</pre></div>
</div>
</section>
</section>
<section id="use-peg-api">
<h2>Use Peg API<a class="headerlink" href="#use-peg-api" title="Permalink to this headline">¶</a></h2>
<p>Function <a class="reference internal" href="api.html#c.P4_LoadGrammar" title="P4_LoadGrammar"><code class="xref c c-func docutils literal notranslate"><span class="pre">P4_LoadGrammar()</span></code></a> can load a grammar from a string.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">P4_Grammar</span><span class="o">*</span> <span class="n">grammar</span> <span class="o">=</span> <span class="n">P4_LoadGrammar</span><span class="p">(</span>
    <span class="s2">"add = int + int;"</span>

    <span class="s2">"@squashed @tight "</span>
    <span class="s2">"int = [0-9]+;"</span>

    <span class="s2">"@spaced @lifted "</span>
    <span class="s2">"ws  = </span><span class="se">\"</span><span class="s2"> </span><span class="se">\"</span><span class="s2">;"</span><span class="p">;</span>
<span class="p">);</span>
</pre></div>
</div>
<p>The one-statement code is somewhat equivalent to the below code written in low-level C API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">P4_Grammar</span><span class="o">*</span> <span class="n">grammar</span> <span class="o">=</span> <span class="n">P4_CreateGrammar</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="n">P4_Ok</span> <span class="o">!=</span> <span class="n">P4_AddSequenceWithMembers</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">RuleAdd</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">P4_CreateReference</span><span class="p">(</span><span class="n">RuleInt</span><span class="p">),</span>
    <span class="n">P4_CreateLiteral</span><span class="p">(</span><span class="s2">"+"</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
    <span class="n">P4_CreateReference</span><span class="p">(</span><span class="n">RuleInt</span><span class="p">)</span>
<span class="p">))</span>
    <span class="n">goto</span> <span class="n">finalize</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">P4_Ok</span> <span class="o">!=</span> <span class="n">P4_AddOnceOrMore</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">RuleInt</span><span class="p">,</span> <span class="n">P4_CreateRange</span><span class="p">(</span><span class="s1">'0'</span><span class="p">,</span> <span class="s1">'9'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">goto</span> <span class="n">finalize</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">P4_Ok</span> <span class="o">!=</span> <span class="n">P4_SetGrammarRuleFlag</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">RuleInt</span><span class="p">,</span> <span class="n">P4_FLAG_SQUASHED</span><span class="o">|</span><span class="n">P4_FLAG_TIGHT</span><span class="p">))</span>
    <span class="n">goto</span> <span class="n">finalize</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">P4_Ok</span> <span class="o">!=</span> <span class="n">P4_AddLiteral</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">RuleWs</span><span class="p">,</span> <span class="s2">" "</span><span class="p">,</span> <span class="n">true</span><span class="p">))</span>
    <span class="n">goto</span> <span class="n">finalize</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">P4_Ok</span> <span class="o">!=</span> <span class="n">P4_SetGrammarRuleFlag</span><span class="p">(</span><span class="n">grammar</span><span class="p">,</span> <span class="n">RuleWs</span><span class="p">,</span> <span class="n">P4_FLAG_SPACED</span><span class="o">|</span><span class="n">P4_FLAG_LIFTED</span><span class="p">))</span>
    <span class="n">goto</span> <span class="n">finalize</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="cheatsheet">
<h2>Cheatsheet<a class="headerlink" href="#cheatsheet" title="Permalink to this headline">¶</a></h2>
<div class="table-wrapper"><table class="docutils align-default" id="id1">
<caption><span class="caption-text">Cheatsheet</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%"/>
<col style="width: 50%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Syntax</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>foo = …;</cite></p></td>
<td><p>grammar rule</p></td>
</tr>
<tr class="row-odd"><td><p><cite>@lifted foo = …;</cite></p></td>
<td><p>drop node</p></td>
</tr>
<tr class="row-even"><td><p><cite>@spaced foo = …;</cite></p></td>
<td><p>mark as space</p></td>
</tr>
<tr class="row-odd"><td><p><cite>@squashed foo = …;</cite></p></td>
<td><p>ignore children</p></td>
</tr>
<tr class="row-even"><td><p><cite>@tight foo = …;</cite></p></td>
<td><p>ignore spaced rules</p></td>
</tr>
<tr class="row-odd"><td><p><cite>@non_terminal foo = …;</cite></p></td>
<td><p>ignore single child node</p></td>
</tr>
<tr class="row-even"><td><p><cite>@scoped foo = …;</cite></p></td>
<td><p>cancle effects</p></td>
</tr>
<tr class="row-odd"><td><p><cite>“literal”</cite></p></td>
<td><p>exact match</p></td>
</tr>
<tr class="row-even"><td><p><cite>“x0dx0a”</cite></p></td>
<td><p>exact match by using ascii digits</p></td>
</tr>
<tr class="row-odd"><td><p><cite>“u4f60u597D”</cite></p></td>
<td><p>exact match utf-8 characters</p></td>
</tr>
<tr class="row-even"><td><p><cite>i”literal”</cite></p></td>
<td><p>case-insensitive match</p></td>
</tr>
<tr class="row-odd"><td><p><cite>[a-z]</cite></p></td>
<td><p>range</p></td>
</tr>
<tr class="row-even"><td><p><cite>[0-9..2]</cite></p></td>
<td><p>range with stride</p></td>
</tr>
<tr class="row-odd"><td><p><cite>[\u0001-\U0010ffff]</cite></p></td>
<td><p>range using unicode runes</p></td>
</tr>
<tr class="row-even"><td><p><cite>[\p{L}]</cite></p></td>
<td><p>range using unicode categories</p></td>
</tr>
<tr class="row-odd"><td><p><cite>.</cite></p></td>
<td><p>any character</p></td>
</tr>
<tr class="row-even"><td><p><cite>foo bar</cite></p></td>
<td><p>sequence</p></td>
</tr>
<tr class="row-odd"><td><p><cite>foo / bar</cite></p></td>
<td><p>choice</p></td>
</tr>
<tr class="row-even"><td><p><cite>&amp;foo</cite></p></td>
<td><p>positive</p></td>
</tr>
<tr class="row-odd"><td><p><cite>!foo</cite></p></td>
<td><p>negative</p></td>
</tr>
<tr class="row-even"><td><p><cite>@cut</cite></p></td>
<td><p>prevent unwanted backtracking</p></td>
</tr>
<tr class="row-odd"><td><p><cite>foo*</cite></p></td>
<td><p>zero or more</p></td>
</tr>
<tr class="row-even"><td><p><cite>foo+</cite></p></td>
<td><p>once or more</p></td>
</tr>
<tr class="row-odd"><td><p><cite>foo?</cite></p></td>
<td><p>optional</p></td>
</tr>
<tr class="row-even"><td><p><cite>foo{m,}</cite></p></td>
<td><p>repeat at least m times</p></td>
</tr>
<tr class="row-odd"><td><p><cite>foo{,n}</cite></p></td>
<td><p>repeat at most n times</p></td>
</tr>
<tr class="row-even"><td><p><cite>foo{m,n}</cite></p></td>
<td><p>repeat between m-n times</p></td>
</tr>
<tr class="row-odd"><td><p><cite>foo{m}</cite></p></td>
<td><p>repeat exact n times</p></td>
</tr>
<tr class="row-even"><td><p><cite># IGNORE</cite></p></td>
<td><p>comment</p></td>
</tr>
</tbody>
</table></div>
</section>
</section>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="lowlevel.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Low Level APIs</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="concepts.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Concepts</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, Ju
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="_sources/peg.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">PEG APIs</a><ul>
<li><a class="reference internal" href="#grammar-rules">Grammar Rules</a></li>
<li><a class="reference internal" href="#literal">Literal</a></li>
<li><a class="reference internal" href="#range">Range</a></li>
<li><a class="reference internal" href="#dot">Dot</a></li>
<li><a class="reference internal" href="#sequence">Sequence</a></li>
<li><a class="reference internal" href="#choice">Choice</a></li>
<li><a class="reference internal" href="#reference">Reference</a></li>
<li><a class="reference internal" href="#positive">Positive</a></li>
<li><a class="reference internal" href="#negative">Negative</a></li>
<li><a class="reference internal" href="#repeat">Repeat</a></li>
<li><a class="reference internal" href="#cut">Cut</a></li>
<li><a class="reference internal" href="#comment">Comment</a></li>
<li><a class="reference internal" href="#grammar-rule-flags">Grammar Rule Flags</a><ul>
<li><a class="reference internal" href="#spaced">&#64;spaced</a></li>
<li><a class="reference internal" href="#tight">&#64;tight</a></li>
<li><a class="reference internal" href="#lifted">&#64;lifted</a></li>
<li><a class="reference internal" href="#nonterminal">&#64;nonterminal</a></li>
<li><a class="reference internal" href="#squashed">&#64;squashed</a></li>
<li><a class="reference internal" href="#scoped">&#64;scoped</a></li>
</ul>
</li>
<li><a class="reference internal" href="#use-peg-api">Use Peg API</a></li>
<li><a class="reference internal" href="#cheatsheet">Cheatsheet</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/main.js"></script>
    </body>
</html>